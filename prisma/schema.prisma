// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

model diseases {
  id              String   @id @default(auto()) @map("_id") @db.ObjectId
  name            String   @unique
  description     String?
  scientific_name String
  classification  String
  severity        String
  created_at      DateTime @default(now())
  updated_at      DateTime @updatedAt

  // @@map("diseases")
}

type UserInfo {
  first_name   String
  last_name    String
  gender       String
  dob          DateTime
  home_address String
  avatar       String?
}

model users {
  id         String   @id @default(auto()) @map("_id") @db.ObjectId
  username   String   @unique
  email      String
  password   String
  phone      String
  info       UserInfo
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  // @@map("users")
  hospitals hospitals[]
  doctor    doctors?
  patient   patients?
}

type ContactInfo {
  website String? @default("https://examplewebsite.com")
  phone   String? @default("0938656495")
  email   String? @default("123abc@abc.com")
  address String?
}

// model Gallery {
//   id          String     @id @default(auto()) @map("_id") @db.ObjectId
//   name        String
//   description String?
//   file        String
//   doctors     doctors?   @relation(fields: [doctorsId], references: [id])
//   doctorsId   String?    @db.ObjectId
//   hospitals   hospitals? @relation(fields: [hospitalsId], references: [id])
//   hospitalsId String?    @db.ObjectId
// }

type Gallery {
  id          String?  @map("_id") @db.ObjectId
  name        String
  description String?
  file        String
  created_at  DateTime @default(now())
  updated_at  DateTime @default(now())
}

type Location {
  type        String
  coordinates Float[]
}

model hospitals {
  id            String       @id @default(auto()) @map("_id") @db.ObjectId
  name          String       @unique
  location      Location
  director      String       @db.ObjectId
  gallery       Gallery[]
  capacity      Int
  contact_info  ContactInfo?
  created_at    DateTime     @default(now())
  updated_at    DateTime     @updatedAt
  director_info users?       @relation(fields: [director], references: [id])
  // @@map("hospitals")
  medicines     medicines[]
}

// model WorkHistory {
//   id          String    @id @default(auto()) @map("_id") @db.ObjectId
//   hospital    hospitals @relation(fields: [hospitalsId], references: [id])
//   salary      Float
//   file        String
//   start_date  DateTime
//   end_date    DateTime
//   hospitalsId String    @db.ObjectId
//   doctors     doctors?  @relation(fields: [doctorsId], references: [id])
//   doctorsId   String?   @db.ObjectId
// }

type WorkHistory {
  id         String?   @map("_id") @db.ObjectId
  hospital   String    @db.ObjectId
  salary     Float
  start_date DateTime
  end_date   DateTime?
  created_at DateTime  @default(now())
  updated_at DateTime  @default(now())
}

// model CertificateInfo {
//   id          String   @id @default(auto()) @map("_id") @db.ObjectId
//   issuer      String
//   validator   String
//   program     String
//   type        String
//   image       String
//   level       Int
//   issued_date DateTime
//   end_date    DateTime
//   doctors     doctors? @relation(fields: [doctorsId], references: [id])
//   doctorsId   String?  @db.ObjectId
// }

type CertificateInfo {
  id          String?   @map("_id") @db.ObjectId
  issuer      String
  validator   String
  program     String
  type        String
  image       String
  level       Int
  issued_date DateTime
  end_date    DateTime?
  created_at  DateTime  @default(now())
  updated_at  DateTime  @default(now())
}

model doctors {
  id           String            @id @default(auto()) @map("_id") @db.ObjectId
  npi          String            @unique
  user_info    users?            @relation(fields: [user_id], references: [id])
  speciality   String
  gallery      Gallery[]
  biography    String
  work_history WorkHistory[]
  certificates CertificateInfo[]
  created_at   DateTime          @default(now())
  updated_at   DateTime          @updatedAt

  // @@map("doctors")
  user_id String @unique @db.ObjectId
}

type Prescription {
  id         String?  @db.ObjectId
  medicine   String   @db.ObjectId
  quantity   Int
  notes      String
  created_at DateTime @default(now())
  updated_at DateTime @default(now())
}

type DiseaseHistory {
  id            String?        @db.ObjectId
  name          String
  diseases      String         @db.ObjectId
  description   String
  examiner      String         @db.ObjectId
  prescriptions Prescription[]
  examined_at   DateTime
  reexamine_at  DateTime?
  created_at    DateTime       @default(now())
  updated_at    DateTime       @default(now())
}

model patients {
  id               String           @id @default(auto()) @map("_id") @db.ObjectId
  user_info        users?           @relation(fields: [user_id], references: [id])
  diseases_history DiseaseHistory[]
  created_at       DateTime         @default(now())
  updated_at       DateTime         @updatedAt
  user_id          String           @unique @db.ObjectId
}

model medicines {
  id          String    @id @default(auto()) @map("_id") @db.ObjectId
  name        String
  brand       String
  description String
  quantity    Int
  price       Float
  hospital    hospitals @relation(fields: [hospital_id], references: [id])
  image       String
  created_at  DateTime  @default(now())
  updated_at  DateTime  @updatedAt

  hospital_id String @db.ObjectId
}
